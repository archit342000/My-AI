<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <title>LMStudioChat | Luminous Workspace</title>
    <meta name="description" content="A modern, airy AI interface built with Luminous Material principles.">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="min-h-screen">
    <!-- Main Shell -->
    <div id="app-root">

        <!-- Navigation Rail (Resizable) -->
        <aside id="sidebar" class="sidebar-expanded">
            <!-- Precision Drag Handle -->
            <div class="resize-handle" id="sidebar-resizer"></div>

            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <h1 class="sidebar-text font-heading"
                    style="font-size: 1.5rem; font-weight: 800; color: var(--color-primary-600); margin: 0; letter-spacing: -0.02em;">
                    LMStudioChat</h1>
                <button id="sidebar-toggle" class="btn-secondary"
                    style="width: 2.5rem; height: 2.5rem; padding: 0; border-radius: 0.75rem;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <path d="M15 6l-6 6 6 6" id="toggle-icon-path" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <!-- Sidebar Scrollable Content -->
            <div class="sidebar-content">

                <!-- Chat Actions -->
                <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem;">
                    <button id="new-chat-btn" class="btn-primary" style="width: 100%; justify-content: flex-start; gap: 12px; height: 40px; font-size: 0.875rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        New Chat
                    </button>
                    <button id="temp-chat-btn" class="btn-secondary" style="width: 100%; justify-content: flex-start; gap: 12px; height: 40px; font-size: 0.875rem; border-style: dashed;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Temporary Chat
                    </button>
                </div>

                <!-- Chat History List -->
                <div id="chat-history-list" style="flex: 1; overflow-y: auto; margin-bottom: 1rem; display: flex; flex-direction: column; gap: 0.25rem;">
                    <!-- Chat items will be injected here -->
                </div>

                <!-- Primary Navigation -->
                <nav style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <div class="nav-item" id="memory-toggle-container" style="cursor: pointer; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" style="display:none;"/> <!-- Placeholder -->
                                <path d="M12 2a10 10 0 1 0 10 10H12V2z"/> <!-- Pie chart ish for memory -->
                            </svg>
                            <span class="sidebar-text">Memory Mode</span>
                        </div>
                        <div class="toggle-switch" id="memory-toggle-switch" style="scale: 0.8; margin-right: -8px;">
                            <div class="toggle-handle"></div>
                        </div>
                        <span class="nav-tooltip">Toggle Memory</span>
                    </div>

                    <a href="#" id="model-trigger" class="nav-item active">
                        <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path
                                d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z" />
                            <polyline points="3.29 7 12 12 20.71 7" />
                            <line x1="12" y1="22" x2="12" y2="12" />
                        </svg>
                        <span id="current-model-display" class="sidebar-text" style="font-weight: 700;">Llama 4
                            Maverick</span>
                        <span class="nav-tooltip">Switch Model</span>
                    </a>
                    <a href="#" id="persona-trigger" class="nav-item">
                        <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M12 2a5 5 0 100 10 5 5 0 000-10zM2 20a10 10 0 0120 0" />
                            <path d="M16 11l-2 2 4 4" />
                        </svg>
                        <span class="sidebar-text">Persona</span>
                        <span class="nav-tooltip">Persona</span>
                    </a>
                    <a href="#" id="tuning-trigger" class="nav-item">
                        <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 14V3M1 14h6M9 8h6M17 14h6" />
                        </svg>
                        <span class="sidebar-text">Tuning</span>
                        <span class="nav-tooltip">Tuning</span>
                    </a>
                    <a href="#" id="theme-toggle" class="nav-item">
                        <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" id="theme-icon-path" />
                        </svg>
                        <span class="sidebar-text">Appearance</span>
                        <span class="nav-tooltip">Theme</span>
                    </a>
                </nav>




                <!-- Empty spacer to maintain layout -->
                <div style="margin-top: auto;"></div>

                <a href="#" id="clear-api-trigger" class="nav-item danger" title="Clear Connection Settings">
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-4v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <span class="sidebar-text">Reset Connection</span>
                    <span class="nav-tooltip">Reset Connection</span>
                </a>
            </div>

            <div class="user-profile">
                <div
                    style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background: var(--color-primary-50); display: flex; align-items: center; justify-content: center; color: var(--color-primary-600); font-weight: 800; font-size: 0.875rem;">
                    US</div>
                <div class="sidebar-text">
                    <div style="font-size: 0.875rem; font-weight: 700; color: var(--content-primary);">Guest User</div>
                    <div style="font-size: 0.75rem; color: var(--content-muted); font-family: var(--font-mono);">
                        Active Session</div>
                </div>
            </div>
        </aside>

        <!-- Main Fluid Content -->
        <main>
            <!-- Mobile Menu Trigger -->
            <button id="mobile-toggle" class="btn-secondary glass" title="Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M3 12h18M3 6h18M3 18h18" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>

            <!-- Centered Message Stream -->
            <div id="messages">
                <!-- Welcome Hero (Carousel State) - Directive M -->
                <div id="welcome-hero">
                    <div class="carousel-viewport">
                        <div class="carousel-track">
                            <!-- Clone of Slide 4 for seamless loop -->
                            <div class="carousel-slide clone">
                                <div class="slide-content">
                                    <div class="slide-label">SECURITY 04</div>
                                    <h2 class="font-heading">Secure Ephemerality</h2>
                                    <p>Experience zero-disk privacy. While your API key is cached securely via
                                        salt-based obfuscation, all chat history and parameters are wiped clean on every
                                        page refresh.</p>
                                    <div class="slide-icon">üõ°Ô∏è</div>
                                </div>
                            </div>

                            <!-- Slide 1: Multi-Model -->
                            <div class="carousel-slide">
                                <div class="slide-content">
                                    <div class="slide-label">ORCHESTRATION 01</div>
                                    <h2 class="font-heading">LM Studio Integration</h2>
                                    <p>Experience local AI inference with LM Studio. Connect to your local server and
                                        enjoy unlimited tokens with full privacy and control.</p>
                                    <div class="slide-icon">‚ö°</div>
                                </div>
                            </div>

                            <!-- Slide 2: Personas -->
                            <div class="carousel-slide">
                                <div class="slide-content">
                                    <div class="slide-label">IDENTITY 02</div>
                                    <h2 class="font-heading">Expert Personas</h2>
                                    <p>Transform your workspace by defining custom system prompts. Switch between
                                        diverse professional roles to tailor instructions and output structure to your
                                        specific domain.</p>
                                    <div class="slide-icon">üë§</div>
                                </div>
                            </div>

                            <!-- Slide 3: Tuning -->
                            <div class="carousel-slide">
                                <div class="slide-content">
                                    <div class="slide-label">PRECISION 03</div>
                                    <h2 class="font-heading">Sampling Control</h2>
                                    <p>Master your output using real-time sliders for Temperature, Top-P, and Penalties.
                                        Fine-tune the balance between creative exploration and deterministic accuracy.
                                    </p>
                                    <div class="slide-icon">üéõÔ∏è</div>
                                </div>
                            </div>

                            <!-- Slide 4: Security -->
                            <div class="carousel-slide">
                                <div class="slide-content">
                                    <div class="slide-label">SECURITY 04</div>
                                    <h2 class="font-heading">Secure Ephemerality</h2>
                                    <p>Experience zero-disk privacy. While your API key is cached securely via
                                        salt-based obfuscation, all chat history and parameters are wiped clean on every
                                        page refresh.</p>
                                    <div class="slide-icon">üõ°Ô∏è</div>
                                </div>
                            </div>

                            <!-- Clone of Slide 1 for seamless loop -->
                            <div class="carousel-slide clone">
                                <div class="slide-content">
                                    <div class="slide-label">ORCHESTRATION 01</div>
                                    <h2 class="font-heading">LM Studio Integration</h2>
                                    <p>Experience local AI inference with LM Studio. Connect to your local server and
                                        enjoy unlimited tokens with full privacy and control.</p>
                                    <div class="slide-icon">‚ö°</div>
                                </div>
                            </div>
                        </div>


                        <div class="carousel-dots">
                            <div class="dot active"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>
                </div>

                <!-- Global Clear Chat Action (Context Aware) -->
                <button id="clear-chat-btn" class="utility-btn glass" title="Clear Chat">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-4v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span>Clear Chat</span>
                </button>
            </div>
    </div>

    <!-- Floating Entry Area -->
    <div id="chat-input-area">
        <div class="input-container" style="position: relative;">
            <input type="file" id="image-input" accept="image/*" style="display: none;">

            <div id="image-preview-container" class="hidden">
                <img id="image-preview" src="" alt="Image Preview">
                <button id="remove-image-btn">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <button id="attach-btn" class="btn-ghost" title="Attach image">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"
                        stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>

            <textarea id="chat-textarea" placeholder="Start a conversation..." rows="1"></textarea>

            <button id="send-btn" class="send-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
        </div>
    </div>
    </main>
    </div>

    <!-- Authorization Overlay -->
    <div id="api-modal" class="modal-backdrop open">
        <div class="modal-content" style="text-align: center;">
            <div class="hardware-surface"
                style="width: 4rem; height: 4rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem auto; color: var(--color-primary-600);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                    <path d="M7 11V7a5 5 0 0110 0v4" />
                </svg>
            </div>
            <h2 class="font-heading"
                style="font-size: 1.75rem; font-weight: 800; color: var(--content-primary); margin-bottom: 0.75rem; letter-spacing: -0.02em;">
                Backend Settings</h2>
            <p style="color: var(--content-muted); font-size: 0.875rem; line-height: 1.6; margin-bottom: 2rem;">
                Configure where the backend connects to LM Studio. If no API token is required, leave it blank.</p>

            <div style="text-align: left; margin-bottom: 1.25rem;">
                <label class="text-xs"
                    style="color: var(--content-muted); font-weight: 700; margin-bottom: 0.5rem; display: block; letter-spacing: 0.1em;">SERVER
                    LINK</label>
                <input type="text" id="server-link-input" class="input-luminous" placeholder="http://localhost:1234"
                    autofocus style="width: 100%; height: 3rem;">
            </div>

            <div style="text-align: left; margin-bottom: 2rem;">
                <label class="text-xs"
                    style="color: var(--content-muted); font-weight: 700; margin-bottom: 0.5rem; display: block; letter-spacing: 0.1em;">API
                    TOKEN (OPTIONAL)</label>
                <input type="password" id="api-token-input" class="input-luminous" placeholder="lm-studio"
                    style="width: 100%; height: 3rem;">
            </div>

            <button id="save-api-key" class="btn-primary"
                style="width: 100%; height: 3.5rem; font-size: 1rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">Connect
                & Initialize</button>
        </div>
    </div>

    <!-- Precision Tuning Overlay -->
    <div id="sampling-modal" class="modal-backdrop">
        <div class="modal-content">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 class="font-heading"
                    style="font-size: 1.5rem; font-weight: 800; color: var(--content-primary); margin: 0; letter-spacing: -0.02em;">
                    Precision Tuning</h2>
                <button id="close-sampling" class="btn-ghost"
                    style="width: 2.5rem; height: 2.5rem; padding: 0; border-radius: 0.75rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 1.25rem;">
                <!-- Temperature -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">TEMPERATURE</span>
                        <span id="temp-val" class="badge">1.0</span>
                    </div>
                    <input type="range" id="temp-slider" min="0" max="2" step="0.1" value="1">
                </div>
                <!-- Top P -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">TOP P</span>
                        <span id="top-p-val" class="badge">1.0</span>
                    </div>
                    <input type="range" id="top-p-slider" min="0" max="1" step="0.05" value="1">
                </div>
                <!-- Max Tokens -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">MAX TOKENS</span>
                        <span id="max-tokens-val" class="badge">2048</span>
                    </div>
                    <input type="range" id="max-tokens-slider" min="0" max="32768" step="128" value="2048">
                </div>
                <!-- Top K -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">TOP K</span>
                        <span id="top-k-val" class="badge">40</span>
                    </div>
                    <input type="range" id="top-k-slider" min="0" max="100" step="1" value="40">
                </div>
                <!-- Min P -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">MIN P</span>
                        <span id="min-p-val" class="badge">0.05</span>
                    </div>
                    <input type="range" id="min-p-slider" min="0" max="1" step="0.01" value="0.05">
                </div>
                <!-- Presence Penalty -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">PRESENCE
                            PENALTY</span>
                        <span id="presence-penalty-val" class="badge">0.0</span>
                    </div>
                    <input type="range" id="presence-penalty-slider" min="-2" max="2" step="0.1" value="0">
                </div>
                <!-- Frequency Penalty -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">FREQUENCY
                            PENALTY</span>
                        <span id="frequency-penalty-val" class="badge">0.0</span>
                    </div>
                    <input type="range" id="frequency-penalty-slider" min="-2" max="2" step="0.1" value="0">
                </div>
                <!-- Reasoning Level -->
                <div class="hardware-surface" style="padding: 1.25rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <span class="text-xs" style="color: var(--content-muted); font-weight: 700;">REASONING
                            LEVEL</span>
                        <span id="reasoning-level-val" class="badge">Medium</span>
                    </div>
                    <input type="range" id="reasoning-level-slider" min="0" max="3" step="1" value="2">
                    <div
                        style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.625rem; color: var(--content-muted); font-weight: 600;">
                        <span>NONE</span>
                        <span>LOW</span>
                        <span>MEDIUM</span>
                        <span>HIGH</span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 2rem; display: flex; justify-content: flex-end; gap: 1rem;">
                <button id="reset-sampling" class="btn-ghost" style="height: 3.5rem; padding: 0 1.5rem;">Reset
                    defaults</button>
                <button id="save-sampling" class="btn-primary" style="height: 3.5rem; padding: 0 2.5rem;">Save
                    configuration</button>
            </div>
        </div>
    </div>

    <!-- System Prompt Overlay -->
    <div id="prompt-modal" class="modal-backdrop">
        <div class="modal-content">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 class="font-heading"
                    style="font-size: 1.5rem; font-weight: 800; color: var(--content-primary); margin: 0; letter-spacing: -0.02em;">
                    System Persona</h2>
                <button id="close-prompt" class="btn-ghost"
                    style="width: 2.5rem; height: 2.5rem; padding: 0; border-radius: 0.75rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
            <p style="color: var(--content-muted); font-size: 0.875rem; line-height: 1.6; margin-bottom: 1.5rem;">
                Define the personality, constraints, and expertise level for the AI cluster.</p>

            <textarea id="system-prompt-input" class="input-luminous"
                placeholder="You are a helpful assistant specialized in..."
                style="width: 100%; height: 200px; padding: 1.25rem; font-family: var(--font-serif); resize: vertical; line-height: 1.6;"></textarea>

            <div style="margin-top: 2rem; display: flex; justify-content: flex-end; gap: 1rem;">
                <button id="reset-prompt" class="btn-ghost" style="height: 3.5rem; padding: 0 1.5rem;">Reset
                    defaults</button>
                <button id="save-prompt" class="btn-primary" style="height: 3.5rem; padding: 0 2.5rem;">Apply
                    configuration</button>
            </div>
        </div>
    </div>

    <!-- Model Selection Overlay -->
    <div id="model-modal" class="modal-backdrop">
        <div class="modal-content">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 class="font-heading"
                    style="font-size: 1.5rem; font-weight: 800; color: var(--content-primary); margin: 0; letter-spacing: -0.02em;">
                    Select Intelligence</h2>
                <button id="close-model" class="btn-ghost"
                    style="width: 2.5rem; height: 2.5rem; padding: 0; border-radius: 0.75rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <div id="model-list-container" style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="text-align: center; padding: 2rem; color: var(--content-muted);">
                    Loading models from server...
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>